# ğŸ“š Library Chatbot

An intelligent chatbot that answers library FAQs and provides personalized database recommendations using RAG (Retrieval-Augmented Generation) with OpenAI embeddings.

## âœ¨ Features

- ğŸ’¬ **Interactive Chat Interface** - Clean, modern UI built with Streamlit
- ğŸ“– **FAQ Answering** - Instant answers to common library questions
- ğŸ” **Database Recommendations** - Smart suggestions based on research topics
- ğŸ¯ **Intent Detection** - Automatically understands query type
- ğŸ“Š **Real-time Statistics** - Track usage and performance
- ğŸ›ï¸ **Adjustable Thresholds** - Fine-tune confidence levels
- ğŸ” **Debug Mode** - See exactly what the model is matching

## ğŸš€ Quick Start

### Prerequisites

- Python 3.8+
- OpenAI API key ([Get one here](https://platform.openai.com/api-keys))

### Installation

```bash
# Clone the repository
git clone <your-repo-url>
cd library-chatbot

# Install dependencies
pip install -r requirements.txt

# Build the embedding indices (required first time)
python build_index.py

# Run the Streamlit app
streamlit run app.py
```

### First-Time Setup

1. The app will open in your browser at `http://localhost:8501`
2. Enter your OpenAI API key in the sidebar
3. Wait for initialization (~2-3 seconds)
4. Start chatting!

## ğŸ“ Project Structure

```
library-chatbot/
â”œâ”€â”€ app.py                      # Streamlit web interface
â”œâ”€â”€ build_index.py              # Builds embedding indices
â”œâ”€â”€ chat.py                     # CLI version (optional)
â”œâ”€â”€ requirements.txt            # Python dependencies
â”œâ”€â”€ library_faq_clean.csv       # FAQ source data
â”œâ”€â”€ Databases description.csv   # Database source data
â”œâ”€â”€ .gitignore                  # Git ignore rules
â”œâ”€â”€ README.md                   # This file
â””â”€â”€ SETUP_GUIDE.md             # Detailed setup instructions
```

**Generated files (not in Git):**
- `faq_text.parquet`, `faq_emb.npy` - FAQ embeddings
- `db_text.parquet`, `db_emb.npy` - Database embeddings

## ğŸ’¡ Usage Examples

### Library Service Questions
```
"What are your opening hours?"
"How do I renew a book?"
"Can I access databases from home?"
```

### Database Recommendations
```
"Which database should I use for engineering articles?"
"Where can I find medical research papers?"
"Best source for computer science conference papers?"
```

## ğŸ”§ Configuration

### Adjusting Confidence Thresholds

In the app sidebar under "Advanced Settings":
- **FAQ Confidence**: 0.60 (default) - Higher = stricter FAQ matching
- **Database Confidence**: 0.45 (default) - Higher = stricter DB matching

### Rebuilding Indices

If you update your CSV files:

```bash
python build_index.py
```

Then restart the Streamlit app.

## ğŸŒ Deployment

### Streamlit Community Cloud (Recommended)

1. **Push to GitHub** - Push ALL Python files and CSV files (but NOT .parquet or .npy files)
2. Visit [share.streamlit.io](https://share.streamlit.io)
3. Connect your repository and select `app.py`
4. **IMPORTANT: Add your API key in Secrets**:
   - Click "Advanced settings" â†’ "Secrets"
   - Add:
     ```toml
     OPENAI_API_KEY = "sk-your-actual-key-here"
     ```
5. Deploy!

**First deployment will take 2-3 minutes** as it builds the embedding indices automatically.

See [SETUP_GUIDE.md](SETUP_GUIDE.md) for Docker and other deployment options.

## ğŸ“Š Architecture

```
User Query
    â†“
Query Embedding (OpenAI)
    â†“
Parallel Search
    â”œâ”€â†’ FAQ Retriever (cosine similarity)
    â””â”€â†’ DB Retriever (cosine similarity)
    â†“
Intent Detection
    â†“
Response Router
    â”œâ”€â†’ FAQ Answer
    â”œâ”€â†’ DB Recommendations
    â”œâ”€â†’ Both (hybrid)
    â””â”€â†’ Clarification Request
    â†“
Formatted Response
```

## ğŸ§ª Tech Stack

- **Frontend**: Streamlit
- **Embeddings**: OpenAI text-embedding-3-small
- **Similarity Search**: Cosine similarity with numpy
- **Data Storage**: Parquet + NumPy arrays
- **Language**: Python 3.8+

## ğŸ’° Cost Estimation

Using `text-embedding-3-small`:
- Cost: ~$0.02 per 1M tokens
- Average query: ~50 tokens
- **Cost per query: ~$0.000001** (essentially free for normal use)

Monitor usage at: https://platform.openai.com/usage

## ğŸ› ï¸ Development

### Running CLI Version

```bash
python chat.py
```

### Running Tests (if you add them)

```bash
pytest tests/
```

### Code Style

```bash
# Format code
black *.py

# Lint
flake8 *.py
```

## ğŸ› Troubleshooting

### "FileNotFoundError: faq_text.parquet"
```bash
python build_index.py
```

### "OpenAI API Error"
- Verify API key is correct
- Check account has credits
- Ensure internet connection

### Slow Performance
- First query is slower (embedding generation)
- Subsequent queries use cached embeddings
- Check OpenAI API status

See [SETUP_GUIDE.md](SETUP_GUIDE.md) for more troubleshooting tips.

## ğŸ¤ Contributing

1. Fork the repository
2. Create a feature branch (`git checkout -b feature/amazing-feature`)
3. Commit changes (`git commit -m 'Add amazing feature'`)
4. Push to branch (`git push origin feature/amazing-feature`)
5. Open a Pull Request

## ğŸ“ License

This project is licensed under the MIT License - see the [LICENSE](LICENSE) file for details.

## ğŸ™ Acknowledgments

- OpenAI for embedding models
- Streamlit for the awesome framework
- Your library team for the data

## ğŸ“ Contact

For questions or support, please open an issue on GitHub.

---

**Note**: Remember to run `python build_index.py` before first use and after updating CSV files!